{"version":3,"sources":["ng://ngx-image-cropper/src/image.utils.ts","ng://ngx-image-cropper/src/image-cropper.component.ts","ng://ngx-image-cropper/src/image-cropper.module.ts"],"names":["ImageUtils","getOrientation","imageBase64","view","DataView","this","base64ToArrayBuffer","getUint16","length","byteLength","offset","marker","getUint32","little","tags","i","replace","binaryString","atob","len","bytes","Uint8Array","charCodeAt","buffer","resetOrientation","srcBase64","srcOrientation","callback","img","Image","onload","width","height","canvas","document","createElement","ctx","getContext","transformCanvas","drawImage","toDataURL","src","orientation","transform","ImageCropperComponent","elementRef","sanitizer","cd","x1","y1","x2","y2","EventEmitter","initCropper","Object","defineProperty","prototype","file","loadImageFile","event","target","files","loadBase64Image","ngOnChanges","changes","_this","setTimeout","setMaxSize","checkCropperPosition","doAutoCrop","markForCheck","resetCropperPosition","imageVisible","originalImage","safeImgDataUrl","moveStart","active","type","position","clientX","clientY","maxSize","originalSize","cropper","fileReader","FileReader","imageType","isValidImageType","checkExifRotationAndLoadImage","result","e","loadImageFailed","emit","readAsDataURL","exifRotation","rotatedBase64","bypassSecurityTrustResourceUrl","imageLoadedInView","imageLoaded","onResize","resizeCropperPosition","displayedImage","nativeElement","querySelector","offsetWidth","offsetHeight","aspectRatio","cropperHeight","cropperWidth","startMove","moveType","assign","getClientX","getClientY","moveImg","stopPropagation","preventDefault","move","resize","detectChanges","el","marginLeft","bypassSecurityTrustStyle","maintainSize","moveStop","diffX","diffY","Math","min","max","maintainAspectRatio","checkAspectRatio","overflowX","overflowY","autoCrop","crop","ratio","left","round","top_1","resizeRatio","getResizeRatio","resizedWidth","floor","resizedHeight","cropCanvas","cropToOutputType","output","cropperPosition","outputType","base64","cropToBase64","imageCropped","cropToFile","then","format","getQuality","imageCroppedBase64","getCanvasBlob","imageCroppedFile","Promise","resolve","toBlob","imageQuality","resizeToWidth","onlyScaleDown","touches","Component","args","selector","template","changeDetection","ChangeDetectionStrategy","OnPush","ElementRef","DomSanitizer","ChangeDetectorRef","Input","Output","HostListener","ImageCropperModule","NgModule","imports","CommonModule","declarations","exports"],"mappings":"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","sourcesContent":["export class ImageUtils {\n    static getOrientation(imageBase64: string): number {\n        const view = new DataView(this.base64ToArrayBuffer(imageBase64));\n        if (view.getUint16(0, false) != 0xFFD8) {\n            return -2;\n        }\n        const length = view.byteLength;\n        let offset = 2;\n        while (offset < length) {\n            if (view.getUint16(offset + 2, false) <= 8) return -1;\n            const marker = view.getUint16(offset, false);\n            offset += 2;\n            if (marker == 0xFFE1) {\n                if (view.getUint32(offset += 2, false) != 0x45786966) {\n                    return -1;\n                }\n\n                const little = view.getUint16(offset += 6, false) == 0x4949;\n                offset += view.getUint32(offset + 4, little);\n                const tags = view.getUint16(offset, little);\n                offset += 2;\n                for (let i = 0; i < tags; i++) {\n                    if (view.getUint16(offset + (i * 12), little) == 0x0112) {\n                        return view.getUint16(offset + (i * 12) + 8, little);\n                    }\n                }\n            }\n            else if ((marker & 0xFF00) != 0xFF00) {\n                break;\n            }\n            else {\n                offset += view.getUint16(offset, false);\n            }\n        }\n        return -1;\n    }\n\n    private static base64ToArrayBuffer(imageBase64: string) {\n        imageBase64 = imageBase64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\n        const binaryString = atob(imageBase64);\n        const len = binaryString.length;\n        const bytes = new Uint8Array(len);\n        for (let i = 0; i < len; i++) {\n            bytes[i] = binaryString.charCodeAt(i);\n        }\n        return bytes.buffer;\n    }\n\n    static resetOrientation(srcBase64: string, srcOrientation: number, callback: Function) {\n        const img = new Image();\n        img.onload = function () {\n            const width = img.width;\n            const height = img.height;\n            const canvas = document.createElement('canvas');\n            const ctx = canvas.getContext('2d');\n\n            if (ctx) {\n                if (4 < srcOrientation && srcOrientation < 9) {\n                    canvas.width = height;\n                    canvas.height = width;\n                } else {\n                    canvas.width = width;\n                    canvas.height = height;\n                }\n                ImageUtils.transformCanvas(ctx, srcOrientation, width, height);\n                ctx.drawImage(img, 0, 0);\n                callback(canvas.toDataURL());\n            } else {\n                callback(srcBase64);\n            }\n        };\n        img.src = srcBase64;\n    }\n\n    private static transformCanvas(ctx: any, orientation: number, width: number, height: number) {\n        switch (orientation) {\n            case 2:\n                ctx.transform(-1, 0, 0, 1, width, 0);\n                break;\n            case 3:\n                ctx.transform(-1, 0, 0, -1, width, height);\n                break;\n            case 4:\n                ctx.transform(1, 0, 0, -1, 0, height);\n                break;\n            case 5:\n                ctx.transform(0, 1, 1, 0, 0, 0);\n                break;\n            case 6:\n                ctx.transform(0, 1, -1, 0, height, 0);\n                break;\n            case 7:\n                ctx.transform(0, -1, -1, 0, height, width);\n                break;\n            case 8:\n                ctx.transform(0, -1, 1, 0, 0, width);\n                break;\n            default:\n                break;\n        }\n    }\n}\n","import {\n    Component, ElementRef, EventEmitter, HostListener, Input, OnChanges, Output, SimpleChanges,\n    ChangeDetectorRef, ChangeDetectionStrategy\n} from '@angular/core';\nimport { DomSanitizer, SafeUrl, SafeStyle } from '@angular/platform-browser';\nimport { ImageUtils } from './image.utils';\n\ninterface MoveStart {\n    active: boolean;\n    type: string | null;\n    position: string | null;\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n    clientX: number;\n    clientY: number;\n}\n\ninterface Dimensions {\n    width: number;\n    height: number;\n}\n\nexport interface CropperPosition {\n    x1: number;\n    y1: number;\n    x2: number;\n    y2: number;\n}\n\nexport interface ImageCroppedEvent {\n    base64?: string | null;\n    file?: Blob | null;\n    width: number;\n    height: number;\n    cropperPosition: CropperPosition;\n}\n\n@Component({\n    selector: 'image-cropper',\n    templateUrl: './image-cropper.component.html',\n    styleUrls: ['./image-cropper.component.scss'],\n    changeDetection: ChangeDetectionStrategy.OnPush\n})\nexport class ImageCropperComponent implements OnChanges {\n    private originalImage: any;\n    private moveStart: MoveStart;\n    private maxSize: Dimensions;\n    private originalSize: Dimensions;\n\n    safeImgDataUrl: SafeUrl | string;\n    marginLeft: SafeStyle | string = '0px';\n    imageVisible = false;\n\n    @Input()\n    set imageFileChanged(file: File) {\n        this.initCropper();\n        if (file) {\n            this.loadImageFile(file);\n        }\n    }\n\n    @Input()\n    set imageChangedEvent(event: any) {\n        this.initCropper();\n        if (event && event.target && event.target.files && event.target.files.length > 0) {\n            this.loadImageFile(event.target.files[0]);\n        }\n    }\n\n    @Input()\n    set imageBase64(imageBase64: string) {\n        this.initCropper();\n        this.loadBase64Image(imageBase64);\n    }\n\n    @Input() format: 'png' | 'jpeg' | 'bmp' | 'webp' | 'ico' = 'png';\n    @Input() outputType: 'base64' | 'file' | 'both' = 'both';\n    @Input() maintainAspectRatio = true;\n    @Input() aspectRatio = 1;\n    @Input() resizeToWidth = 0;\n    @Input() roundCropper = false;\n    @Input() onlyScaleDown = false;\n    @Input() imageQuality = 92;\n    @Input() autoCrop = true;\n    @Input() cropper: CropperPosition = {\n        x1: -100,\n        y1: -100,\n        x2: 10000,\n        y2: 10000\n    };\n\n    @Output() imageCropped = new EventEmitter<ImageCroppedEvent>();\n    @Output() imageCroppedBase64 = new EventEmitter<string>();\n    @Output() imageCroppedFile = new EventEmitter<Blob>();\n    @Output() imageLoaded = new EventEmitter<void>();\n    @Output() loadImageFailed = new EventEmitter<void>();\n\n    constructor(private elementRef: ElementRef, private sanitizer: DomSanitizer, private cd: ChangeDetectorRef) {\n        this.initCropper();\n    }\n\n    ngOnChanges(changes: SimpleChanges): void {\n        if (changes['cropper']) {\n            setTimeout(() => {\n                this.setMaxSize();\n                this.checkCropperPosition(false);\n                this.doAutoCrop();\n                this.cd.markForCheck();\n            });\n        }\n        if (changes['aspectRatio']) {\n            this.resetCropperPosition();\n        }\n    }\n\n    private initCropper() {\n        this.imageVisible = false;\n        this.originalImage = null;\n        this.safeImgDataUrl = 'data:image/png;base64,iVBORw0KGg'\n            + 'oAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAU'\n            + 'AAarVyFEAAAAASUVORK5CYII=';\n        this.moveStart = {\n            active: false,\n            type: null,\n            position: null,\n            x1: 0,\n            y1: 0,\n            x2: 0,\n            y2: 0,\n            clientX: 0,\n            clientY: 0\n        };\n        this.maxSize = {\n            width: 0,\n            height: 0\n        };\n        this.originalSize = {\n            width: 0,\n            height: 0\n        };\n        this.cropper.x1 = -100;\n        this.cropper.y1 = -100;\n        this.cropper.x2 = 10000;\n        this.cropper.y2 = 10000;\n    }\n\n    private loadImageFile(file: File) {\n        const fileReader = new FileReader();\n        fileReader.onload = (event: any) => {\n            const imageType = file.type;\n            if (this.isValidImageType(imageType)) {\n                try {\n                    this.checkExifRotationAndLoadImage(event.target.result);\n                } catch (e) {\n                    this.loadImageFailed.emit();\n                }\n            } else {\n                this.loadImageFailed.emit();\n            }\n        };\n        fileReader.readAsDataURL(file);\n    }\n\n    private isValidImageType(type: string) {\n        return type === 'image/jpeg'\n            || type === 'image/jpg'\n            || type === 'image/png'\n            || type === 'image/gif'\n    }\n\n    private checkExifRotationAndLoadImage(imageBase64: string) {\n        const exifRotation = ImageUtils.getOrientation(imageBase64);\n        if (exifRotation > 1) {\n            ImageUtils.resetOrientation(\n                imageBase64,\n                exifRotation,\n                (rotatedBase64: string) => this.loadBase64Image(rotatedBase64)\n            );\n        } else {\n            this.loadBase64Image(imageBase64);\n        }\n    }\n\n    private loadBase64Image(imageBase64: string) {\n        this.safeImgDataUrl = this.sanitizer.bypassSecurityTrustResourceUrl(imageBase64);\n        this.originalImage = new Image();\n        this.originalImage.onload = () => {\n            this.originalSize.width = this.originalImage.width;\n            this.originalSize.height = this.originalImage.height;\n            this.cd.markForCheck();\n        };\n        this.originalImage.src = imageBase64;\n    }\n\n    imageLoadedInView(): void {\n        if (this.originalImage != null) {\n            this.imageLoaded.emit();\n            setTimeout(() => {\n                this.setMaxSize();\n                this.resetCropperPosition();\n                this.cd.markForCheck();\n            });\n        }\n    }\n\n    @HostListener('window:resize', ['$event'])\n    onResize(event: Event) {\n        this.resizeCropperPosition();\n        this.setMaxSize();\n    }\n\n    private resizeCropperPosition() {\n        const displayedImage = this.elementRef.nativeElement.querySelector('.source-image');\n        if (this.maxSize.width !== displayedImage.offsetWidth || this.maxSize.height !== displayedImage.offsetHeight) {\n            this.cropper.x1 = this.cropper.x1 * displayedImage.offsetWidth / this.maxSize.width;\n            this.cropper.x2 = this.cropper.x2 * displayedImage.offsetWidth / this.maxSize.width;\n            this.cropper.y1 = this.cropper.y1 * displayedImage.offsetHeight / this.maxSize.height;\n            this.cropper.y2 = this.cropper.y2 * displayedImage.offsetHeight / this.maxSize.height;\n        }\n    }\n\n    private resetCropperPosition() {\n        const displayedImage = this.elementRef.nativeElement.querySelector('.source-image');\n        if (displayedImage.offsetWidth / this.aspectRatio < displayedImage.offsetHeight) {\n            this.cropper.x1 = 0;\n            this.cropper.x2 = displayedImage.offsetWidth;\n            const cropperHeight = displayedImage.offsetWidth / this.aspectRatio;\n            this.cropper.y1 = (displayedImage.offsetHeight - cropperHeight) / 2;\n            this.cropper.y2 = this.cropper.y1 + cropperHeight;\n        } else {\n            this.cropper.y1 = 0;\n            this.cropper.y2 = displayedImage.offsetHeight;\n            const cropperWidth = displayedImage.offsetHeight * this.aspectRatio;\n            this.cropper.x1 = (displayedImage.offsetWidth - cropperWidth) / 2;\n            this.cropper.x2 = this.cropper.x1 + cropperWidth;\n        }\n        this.doAutoCrop();\n        this.imageVisible = true;\n    }\n\n    startMove(event: any, moveType: string, position: string | null = null) {\n        this.moveStart = Object.assign({\n            active: true,\n            type: moveType,\n            position: position,\n            clientX: this.getClientX(event),\n            clientY: this.getClientY(event)\n        }, this.cropper);\n    }\n\n    @HostListener('document:mousemove', ['$event'])\n    @HostListener('document:touchmove', ['$event'])\n    moveImg(event: any) {\n        if (this.moveStart.active) {\n            event.stopPropagation();\n            event.preventDefault();\n            this.setMaxSize();\n            if (this.moveStart.type === 'move') {\n                this.move(event);\n                this.checkCropperPosition(true);\n            } else if (this.moveStart.type === 'resize') {\n                this.resize(event);\n                this.checkCropperPosition(false);\n            }\n            this.cd.detectChanges();\n        }\n    }\n\n    private setMaxSize() {\n        const el = this.elementRef.nativeElement.querySelector('.source-image');\n        this.maxSize.width = el.offsetWidth;\n        this.maxSize.height = el.offsetHeight;\n        this.marginLeft = this.sanitizer.bypassSecurityTrustStyle('calc(50% - ' + this.maxSize.width / 2 + 'px)');\n    }\n\n    private checkCropperPosition(maintainSize = false) {\n        if (this.cropper.x1 < 0) {\n            this.cropper.x2 -= maintainSize ? this.cropper.x1 : 0;\n            this.cropper.x1 = 0;\n        }\n        if (this.cropper.y1 < 0) {\n            this.cropper.y2 -= maintainSize ? this.cropper.y1 : 0;\n            this.cropper.y1 = 0;\n        }\n        if (this.cropper.x2 > this.maxSize.width) {\n            this.cropper.x1 -= maintainSize ? (this.cropper.x2 - this.maxSize.width) : 0;\n            this.cropper.x2 = this.maxSize.width;\n        }\n        if (this.cropper.y2 > this.maxSize.height) {\n            this.cropper.y1 -= maintainSize ? (this.cropper.y2 - this.maxSize.height) : 0;\n            this.cropper.y2 = this.maxSize.height;\n        }\n    }\n\n    @HostListener('document:mouseup', ['$event'])\n    @HostListener('document:touchend', ['$event'])\n    moveStop(event: any) {\n        if (this.moveStart.active) {\n            this.moveStart.active = false;\n            this.doAutoCrop();\n        }\n    }\n\n    private move(event: any) {\n        const diffX = this.getClientX(event) - this.moveStart.clientX;\n        const diffY = this.getClientY(event) - this.moveStart.clientY;\n\n        this.cropper.x1 = this.moveStart.x1 + diffX;\n        this.cropper.y1 = this.moveStart.y1 + diffY;\n        this.cropper.x2 = this.moveStart.x2 + diffX;\n        this.cropper.y2 = this.moveStart.y2 + diffY;\n    }\n\n    private resize(event: any) {\n        const diffX = this.getClientX(event) - this.moveStart.clientX;\n        const diffY = this.getClientY(event) - this.moveStart.clientY;\n        switch (this.moveStart.position) {\n            case 'left':\n                this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - 20);\n                break;\n            case 'topleft':\n                this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - 20);\n                this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - 20);\n                break;\n            case 'top':\n                this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - 20);\n                break;\n            case 'topright':\n                this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + 20);\n                this.cropper.y1 = Math.min(this.moveStart.y1 + diffY, this.cropper.y2 - 20);\n                break;\n            case 'right':\n                this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + 20);\n                break;\n            case 'bottomright':\n                this.cropper.x2 = Math.max(this.moveStart.x2 + diffX, this.cropper.x1 + 20);\n                this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + 20);\n                break;\n            case 'bottom':\n                this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + 20);\n                break;\n            case 'bottomleft':\n                this.cropper.x1 = Math.min(this.moveStart.x1 + diffX, this.cropper.x2 - 20);\n                this.cropper.y2 = Math.max(this.moveStart.y2 + diffY, this.cropper.y1 + 20);\n                break;\n        }\n\n        if (this.maintainAspectRatio) {\n            this.checkAspectRatio();\n        }\n    }\n\n    private checkAspectRatio() {\n        let overflowX = 0;\n        let overflowY = 0;\n\n        switch (this.moveStart.position) {\n            case 'top':\n                this.cropper.x2 = this.cropper.x1 + (this.cropper.y2 - this.cropper.y1) * this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(0 - this.cropper.y1, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y1 += (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'bottom':\n                this.cropper.x2 = this.cropper.x1 + (this.cropper.y2 - this.cropper.y1) * this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y2 -= (overflowY * this.aspectRatio) > overflowX ? overflowY : (overflowX / this.aspectRatio);\n                }\n                break;\n            case 'topleft':\n                this.cropper.y1 = this.cropper.y2 - (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(0 - this.cropper.x1, 0);\n                overflowY = Math.max(0 - this.cropper.y1, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x1 += (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y1 += (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'topright':\n                this.cropper.y1 = this.cropper.y2 - (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(0 - this.cropper.y1, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y1 += (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'right':\n            case 'bottomright':\n                this.cropper.y2 = this.cropper.y1 + (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(this.cropper.x2 - this.maxSize.width, 0);\n                overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x2 -= (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y2 -= (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n            case 'left':\n            case 'bottomleft':\n                this.cropper.y2 = this.cropper.y1 + (this.cropper.x2 - this.cropper.x1) / this.aspectRatio;\n                overflowX = Math.max(0 - this.cropper.x1, 0);\n                overflowY = Math.max(this.cropper.y2 - this.maxSize.height, 0);\n                if (overflowX > 0 || overflowY > 0) {\n                    this.cropper.x1 += (overflowY * this.aspectRatio) > overflowX ? (overflowY * this.aspectRatio) : overflowX;\n                    this.cropper.y2 -= (overflowY * this.aspectRatio) > overflowX ? overflowY : overflowX / this.aspectRatio;\n                }\n                break;\n        }\n    }\n\n    private doAutoCrop() {\n        if (this.autoCrop) {\n            this.crop();\n        }\n    }\n\n    crop() {\n        const displayedImage = this.elementRef.nativeElement.querySelector('.source-image');\n        if (displayedImage && this.originalImage != null) {\n            const ratio = this.originalSize.width / displayedImage.offsetWidth;\n            const left = Math.round(this.cropper.x1 * ratio);\n            const top = Math.round(this.cropper.y1 * ratio);\n            const width = Math.round((this.cropper.x2 - this.cropper.x1) * ratio);\n            const height = Math.round((this.cropper.y2 - this.cropper.y1) * ratio);\n            const resizeRatio = this.getResizeRatio(width);\n            const resizedWidth = Math.floor(width * resizeRatio);\n            const resizedHeight = Math.floor(height * resizeRatio);\n\n            const cropCanvas = document.createElement('canvas') as HTMLCanvasElement;\n            cropCanvas.width = resizedWidth;\n            cropCanvas.height = resizedHeight;\n\n            const ctx = cropCanvas.getContext('2d');\n            if (ctx) {\n                ctx.drawImage(this.originalImage, left, top, width, height, 0, 0, width * resizeRatio, height * resizeRatio);\n                this.cropToOutputType(cropCanvas, resizedWidth, resizedHeight);\n            }\n        }\n    }\n\n    private cropToOutputType(cropCanvas: HTMLCanvasElement, resizedWidth: number, resizedHeight: number) {\n        const output: ImageCroppedEvent = {\n            width: resizedWidth,\n            height: resizedHeight,\n            cropperPosition: Object.assign({}, this.cropper)\n        };\n        switch (this.outputType) {\n            case 'base64':\n                output.base64 = this.cropToBase64(cropCanvas);\n                this.imageCropped.emit(output);\n                break;\n            case 'file':\n                this.cropToFile(cropCanvas)\n                    .then((result: Blob | null) => {\n                        output.file = result;\n                        this.imageCropped.emit(output);\n                    });\n                break;\n            case 'both':\n                output.base64 = this.cropToBase64(cropCanvas);\n                this.cropToFile(cropCanvas)\n                    .then((result: Blob | null) => {\n                        output.file = result;\n                        this.imageCropped.emit(output);\n                    });\n                break;\n        }\n    }\n\n    private cropToBase64(cropCanvas: HTMLCanvasElement): string {\n        const imageBase64 = cropCanvas.toDataURL('image/' + this.format, this.getQuality());\n        this.imageCroppedBase64.emit(imageBase64);\n        return imageBase64;\n    }\n\n    private cropToFile(cropCanvas: HTMLCanvasElement): Promise<Blob | null> {\n        return this.getCanvasBlob(cropCanvas)\n            .then((result: Blob | null) => {\n                if (result) {\n                    this.imageCroppedFile.emit(result);\n                }\n                return result;\n            });\n    }\n\n    private getCanvasBlob(cropCanvas: HTMLCanvasElement): Promise<Blob | null> {\n        return new Promise((resolve) => {\n            cropCanvas.toBlob(\n                (result: Blob | null) => resolve(result),\n                'image/' + this.format,\n                this.getQuality()\n            );\n        });\n    }\n\n    private getQuality(): number {\n        return Math.min(1, Math.max(0, this.imageQuality / 100));\n    }\n\n    private getResizeRatio(width: number): number {\n        return this.resizeToWidth > 0 && (!this.onlyScaleDown || width > this.resizeToWidth)\n            ? this.resizeToWidth / width\n            : 1;\n    }\n\n    private getClientX(event: any) {\n        return event.clientX != null ? event.clientX : event.touches[0].clientX;\n    }\n\n    private getClientY(event: any) {\n        return event.clientY != null ? event.clientY : event.touches[0].clientY;\n    }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { ImageCropperComponent } from './image-cropper.component';\n\n@NgModule({\n    imports: [\n        CommonModule\n    ],\n    declarations: [\n        ImageCropperComponent\n    ],\n    exports: [\n        ImageCropperComponent\n    ]\n})\nexport class ImageCropperModule {}\n"]}